<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Murmures du C≈ìur - Votre sanctuaire √©motionnel</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    :root {
      --primary: #7c3aed;
      --primary-light: #ede9fe;
      --primary-dark: #5b21b6;
      --secondary: #ec4899;
      --secondary-light: #fce7f3;
      --accent: #06b6d4;
      --accent-light: #cffafe;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --text-muted: #94a3b8;
      --border: #e2e8f0;
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
      --shadow-hover: 0 20px 40px rgba(124, 58, 237, 0.1);
      --gradient: linear-gradient(135deg, #7c3aed 0%, #ec4899 50%, #06b6d4 100%);
      --gradient-light: linear-gradient(135deg, #ede9fe 0%, #fce7f3 50%, #cffafe 100%);
      --radius: 20px;
      --radius-sm: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    
    body { 
      font-family: 'Inter', sans-serif; 
      background: var(--bg); 
      color: var(--text); 
      line-height:1.7;
      background-image: 
        radial-gradient(circle at 5% 15%, rgba(124, 58, 237, 0.03) 0%, transparent 25%),
        radial-gradient(circle at 95% 85%, rgba(236, 72, 153, 0.03) 0%, transparent 25%);
    }
    
    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.6s ease-out; }
    .pulse { animation: pulse 2s infinite; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes heartBeat {
      0% { transform: scale(1); }
      25% { transform: scale(1.3); }
      50% { transform: scale(1); }
      75% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    @keyframes notificationPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Modal Styles */
    .modal {
      position: fixed; 
      top:0; left:0; 
      width:100%; height:100%;
      background: rgba(15, 23, 42, 0.7); 
      display:flex; align-items:center; justify-content:center; 
      z-index:1000;
      backdrop-filter: blur(8px);
    }
    
    .modal-content {
      background: var(--card-bg); 
      padding: 2.5rem; 
      border-radius: var(--radius); 
      width:92%; max-width:480px;
      box-shadow: var(--shadow-hover); 
      text-align:center;
      border: 1px solid var(--border);
      transform: scale(0.9);
      animation: modalAppear 0.4s ease-out forwards;
    }

    @keyframes modalAppear {
      to { transform: scale(1); }
    }

    .modal h2 {
      color: var(--primary); 
      margin-bottom: 1rem; 
      font-size: 1.75rem;
      font-weight: 700;
      font-family: 'Playfair Display', serif;
    }
    
    .modal p {
      color: var(--text-light); 
      margin-bottom: 1.5rem; 
      font-size: 1rem;
    }
    
    input, textarea, select {
      width:100%; 
      padding:1rem; 
      margin-bottom:1.2rem; 
      border:2px solid var(--border); 
      border-radius:var(--radius-sm); 
      font-family:inherit; 
      font-size:1rem;
      transition: var(--transition);
      background: #fcfcfc;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1);
      background: white;
      transform: translateY(-2px);
    }
    
    textarea {
      resize: vertical;
      min-height: 120px;
    }
    
    button {
      background: var(--gradient); 
      color:white; 
      border:none; 
      padding:1rem 1.5rem; 
      border-radius:var(--radius-sm);
      font-weight:600; 
      cursor:pointer; 
      font-family:inherit; 
      width:100%; 
      font-size:1rem;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    button:hover { 
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }
    
    button:active { transform: translateY(-1px); }
    
    .btn-secondary {
      background: transparent; 
      color: var(--primary); 
      border: 2px solid var(--primary);
      margin-top:0.5rem;
    }
    
    .btn-secondary:hover { 
      background: var(--primary-light); 
      transform: translateY(-3px);
    }

    .btn-small {
      width: auto;
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
    }

    /* Header Styles */
    header {
      background: rgba(255, 255, 255, 0.9); 
      box-shadow: var(--shadow); 
      padding:1rem 2rem;
      position:sticky; 
      top:0; 
      z-index:100;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.9);
    }
    
    .header-content {
      display:flex; 
      justify-content:space-between; 
      align-items:center; 
      max-width:1400px; 
      margin:0 auto;
      position: relative;
    }
    
    .site-title { 
      font-size:1.8rem; 
      font-weight:700; 
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-family: 'Playfair Display', serif;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* Menu responsive */
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--primary);
      cursor: pointer;
      padding: 0.5rem;
      z-index: 101;
    }

    nav ul { 
      list-style:none; 
      display:flex; 
      gap:1.5rem; 
      align-items:center; 
    }
    
    nav a { 
      text-decoration:none; 
      color:var(--text); 
      font-weight:500; 
      padding:0.6rem 1rem; 
      border-radius:var(--radius-sm); 
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
    }
    
    nav a:hover { 
      background: var(--primary-light); 
      color: var(--primary);
      transform: translateY(-2px);
    }
    
    nav a.active { 
      background: var(--primary-light); 
      color: var(--primary);
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      animation: notificationPulse 1s ease-in-out;
    }
    
    .user-menu {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .user-info { 
      color: var(--text); 
      font-weight:600; 
      display:flex; 
      align-items:center; 
      gap:0.5rem; 
      background: var(--primary-light);
      padding: 0.5rem 1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .user-info:hover {
      background: var(--primary);
      color: white;
    }
    
    .user-info i { color: var(--primary); }
    
    .user-info:hover i {
      color: white;
    }

    .user-mood {
      font-size: 1.2rem;
      margin-left: 0.5rem;
    }

    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow-hover);
      padding: 0.5rem;
      min-width: 150px;
      z-index: 1000;
      display: none;
      border: 1px solid var(--border);
    }

    .user-dropdown.active {
      display: block;
      animation: fadeIn 0.3s ease-out;
    }

    .user-dropdown a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      color: var(--text);
      text-decoration: none;
      border-radius: var(--radius-sm);
      transition: var(--transition);
    }

    .user-dropdown a:hover {
      background: var(--primary-light);
      color: var(--primary);
    }

    /* Section Styles */
    section { 
      display:none; 
      padding:2rem 1.5rem; 
      min-height: calc(100vh - 80px);
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .active { display:block; }
    
    .card { 
      background:var(--card-bg); 
      border-radius:var(--radius); 
      box-shadow: var(--shadow); 
      padding:2rem; 
      margin:0 auto;
      width: 100%;
      max-width: 1000px;
      border: 1px solid var(--border);
      transition: var(--transition);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .card h2 { 
      color:var(--primary); 
      margin-bottom:1rem; 
      font-size:1.8rem;
      font-family: 'Playfair Display', serif;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .card p { 
      color: var(--text-light); 
      margin-bottom:1.5rem; 
      font-size: 1.1rem;
    }

    /* Hero Section */
    .hero {
      text-align: center;
      padding: 4rem 2rem;
      background: var(--gradient-light);
      border-radius: var(--radius);
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }
    
    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%237c3aed' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
      opacity: 0.5;
    }
    
    .hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: 3rem;
      margin-bottom: 1rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
    }
    
    .hero p {
      font-size: 1.2rem;
      color: var(--text-light);
      max-width: 600px;
      margin: 0 auto 2rem;
    }

    /* Stats Cards */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: var(--radius);
      text-align: center;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }
    
    .stat-label {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    /* Chat Styles */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 1000px;
      background: white;
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid var(--border);
    }
    
    .chat-messages { 
      flex: 1; 
      overflow-y:auto; 
      background:#f8fafc; 
      padding:1.5rem; 
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .date-separator {
      text-align: center;
      margin: 1rem 0;
      position: relative;
    }
    
    .date-separator::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--border);
      z-index: 1;
    }
    
    .date-label {
      background: white;
      padding: 0.5rem 1.5rem;
      border-radius: 20px;
      border: 1px solid var(--border);
      color: var(--text-light);
      font-size: 0.9rem;
      font-weight: 500;
      display: inline-block;
      position: relative;
      z-index: 2;
    }
    
    .chat-message {
      background:white; 
      padding:1.2rem; 
      border-radius:16px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid var(--border);
      transition: var(--transition);
      position: relative;
      max-width: 70%;
    }
    
    .chat-message:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .chat-message.own {
      background: var(--primary-light);
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    
    .chat-message.other {
      background: white;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    
    .chat-pseudo { 
      font-weight:600; 
      color:var(--primary); 
      margin-bottom:0.5rem; 
      font-size:0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .chat-actions { 
      margin-top:0.8rem; 
      text-align:right; 
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }
    
    .chat-actions button { 
      width: auto; 
      padding:0.4rem 0.8rem; 
      font-size:0.8rem; 
      border-radius:8px;
      background: transparent;
      color: var(--text-light);
      border: 1px solid var(--border);
    }
    
    .chat-actions button:hover { 
      background: white;
      transform: translateY(-2px);
    }
    
    .btn-delete { 
      color: var(--danger);
      border-color: var(--danger);
    }
    
    .btn-edit { 
      color: var(--warning);
      border-color: var(--warning);
    }

    .chat-input-container {
      padding: 1.5rem;
      background: white;
      border-top: 1px solid var(--border);
    }

    .edit-mode-banner {
      background: var(--warning);
      color: white;
      padding: 0.8rem;
      text-align: center;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    /* Radio Options */
    .privacy-options {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    
    .privacy-option {
      flex: 1;
      min-width: 200px;
    }
    
    .privacy-option input[type="radio"] {
      display: none;
    }
    
    .privacy-option label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      background: white;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }
    
    .privacy-option label:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }
    
    .privacy-option input[type="radio"]:checked + label {
      background: var(--primary-light);
      border-color: var(--primary);
      color: var(--primary);
    }
    
    .privacy-option .radio-icon {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .privacy-option input[type="radio"]:checked + label .radio-icon {
      border-color: var(--primary);
      background: var(--primary);
    }
    
    .privacy-option input[type="radio"]:checked + label .radio-icon::after {
      content: '';
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
    }

    /* Cris Section */
    .cris-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(1fr, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .cris-card {
      background: white;
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
    }
    
    .cris-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .cris-content {
      margin-bottom: 1rem;
      line-height: 1.6;
    }
    
    .cris-meta {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: var(--text-light);
    }
    
    .support-section {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }
    
    .support-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--primary-light);
      border: none;
      border-radius: 20px;
      color: var(--primary);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .support-btn:hover {
      background: var(--primary);
      color: white;
      transform: scale(1.05);
    }
    
    .support-btn.active {
      background: var(--secondary);
      color: white;
      animation: heartBeat 0.6s ease;
    }
    
    .support-count {
      font-weight: 600;
      color: var(--text);
    }
    
    .cris-actions {
      position: absolute;
      top: 1rem;
      right: 1rem;
      display: flex;
      gap: 0.5rem;
    }
    
    .action-btn {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
    }
    
    .action-btn.edit {
      color: var(--warning);
    }
    
    .action-btn.delete {
      color: var(--danger);
    }
    
    .action-btn:hover {
      transform: scale(1.1);
    }

    /* Mes Publications */
    .publications-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(1fr, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    /* Emotional Well-being Tips */
    .tips-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .tip-card {
      background: white;
      padding: 1.5rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    .tip-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient);
    }
    
    .tip-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .tip-icon {
      width: 60px;
      height: 60px;
      background: var(--primary-light);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      color: var(--primary);
      font-size: 1.8rem;
    }

    /* Mood Tracker */
    .mood-tracker {
      background: white;
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
      margin: 2rem 0;
    }
    
    .mood-options {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 1rem;
    }
    
    .mood-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      border: 2px solid transparent;
    }
    
    .mood-option:hover {
      background: var(--primary-light);
    }
    
    .mood-option.active {
      background: var(--primary-light);
      border: 2px solid var(--primary);
    }
    
    .mood-emoji {
      font-size: 2rem;
    }

    /* Resources Section */
    .resources-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .resource-card {
      background: white;
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
      transition: var(--transition);
    }
    
    .resource-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    /* Journal Emotionnel */
    .journal-container {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    
    .journal-form {
      background: white;
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
    }
    
    .journal-entries {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .journal-entry {
      background: white;
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
      transition: var(--transition);
    }
    
    .journal-entry:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    
    .journal-entry-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: var(--text-light);
    }
    
    .journal-entry-content {
      line-height: 1.6;
    }
    
    .journal-entry-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    /* Exercices de respiration */
    .breathing-exercise {
      background: white;
      border-radius: var(--radius);
      padding: 2rem;
      border: 1px solid var(--border);
      text-align: center;
    }
    
    .breathing-circle {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: var(--primary-light);
      margin: 2rem auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
      transition: all 4s ease-in-out;
      position: relative;
    }
    
    .breathing-circle.active {
      transform: scale(1.5);
      background: var(--primary);
      color: white;
    }
    
    .breathing-instructions {
      margin: 1rem 0;
      font-size: 1.1rem;
      color: var(--text);
    }
    
    .breathing-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    /* Admin Panel */
    .admin-panel {
      background: white;
      border-radius: var(--radius);
      padding: 2rem;
      border: 1px solid var(--border);
    }
    
    .admin-messages {
      max-height: 500px;
      overflow-y: auto;
      margin: 1.5rem 0;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 1rem;
    }
    
    .admin-message {
      background: var(--primary-light);
      border-radius: var(--radius-sm);
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid var(--primary);
    }
    
    .admin-message-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    
    .admin-response-form {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }

    /* Notifications */
    .notifications-container {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 1rem;
    }
    
    .notification {
      background: white;
      border-radius: var(--radius-sm);
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-left: 4px solid var(--primary);
      box-shadow: var(--shadow);
    }
    
    .notification.unread {
      background: var(--primary-light);
      border-left-color: var(--accent);
    }
    
    .notification-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    /* Development Message */
    .development-message {
      text-align: center;
      padding: 3rem 2rem;
      background: var(--primary-light);
      border-radius: var(--radius);
      margin: 2rem 0;
    }
    
    .development-message i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    /* Utility Classes */
    .error { 
      color: var(--danger); 
      font-size: 0.9rem; 
      margin-top: 0.4rem; 
      min-height: 1.4rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .success { 
      color: var(--success); 
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .loading { 
      text-align: center; 
      color: var(--text-muted); 
      padding: 2rem; 
      font-style: italic;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .text-muted { color: var(--text-muted); }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .header-content {
        padding: 0 1rem;
      }
      
      section {
        padding: 1.5rem 1rem;
      }
      
      .card {
        padding: 1.5rem;
      }
      
      .hero h1 {
        font-size: 2.5rem;
      }
    }

    @media (max-width: 968px) {
      .header-content {
        flex-direction: row;
        justify-content: space-between;
        padding: 1rem;
      }
      
      .menu-toggle {
        display: block;
      }
      
      nav {
        position: fixed;
        top: 80px;
        left: 0;
        width: 100%;
        background: white;
        box-shadow: var(--shadow);
        padding: 1rem;
        transform: translateY(-100%);
        opacity: 0;
        transition: var(--transition);
        z-index: 99;
        border-top: 1px solid var(--border);
      }
      
      nav.active {
        transform: translateY(0);
        opacity: 1;
      }
      
      nav ul {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      nav a {
        padding: 1rem;
        justify-content: flex-start;
        border-radius: var(--radius-sm);
      }
      
      .user-info {
        background: none;
        padding: 0;
        margin-top: 0.5rem;
      }
      
      .user-menu {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
        width: 100%;
      }
      
      .user-dropdown {
        position: static;
        box-shadow: none;
        border: none;
        background: var(--primary-light);
        width: 100%;
        margin-top: 0.5rem;
      }
      
      .site-title {
        font-size: 1.5rem;
      }
      
      .hero {
        padding: 2rem 1rem;
      }
      
      .hero h1 {
        font-size: 2rem;
      }
      
      .hero p {
        font-size: 1rem;
      }
      
      .stats-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      
      .stat-card {
        padding: 1rem;
      }
      
      .stat-number {
        font-size: 2rem;
      }
      
      .privacy-options {
        flex-direction: column;
      }
      
      .privacy-option {
        min-width: auto;
      }
      
      .chat-container {
        height: 500px;
      }
      
      .chat-message {
        max-width: 85%;
        padding: 1rem;
      }
      
      .cris-grid,
      .publications-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .tips-container,
      .resources-grid {
        grid-template-columns: 1fr;
      }
      
      .mood-options {
        gap: 0.5rem;
      }
      
      .mood-option {
        padding: 0.75rem;
      }
      
      .mood-emoji {
        font-size: 1.5rem;
      }
      
      .card h2 {
        font-size: 1.5rem;
      }
      
      .modal-content {
        padding: 1.5rem;
        margin: 1rem;
      }
      
      .breathing-circle {
        width: 150px;
        height: 150px;
      }
    }

    @media (max-width: 480px) {
      .header-content {
        padding: 0.75rem;
      }
      
      .site-title {
        font-size: 1.3rem;
      }
      
      .hero h1 {
        font-size: 1.8rem;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .stat-number {
        font-size: 1.8rem;
      }
      
      .chat-message {
        max-width: 95%;
      }
      
      .chat-actions {
        flex-direction: column;
        gap: 0.25rem;
      }
      
      .chat-actions button {
        width: 100%;
      }
      
      .mood-options {
        flex-direction: column;
        align-items: center;
      }
      
      .mood-option {
        width: 100%;
        max-width: 200px;
      }
      
      section {
        padding: 1rem 0.5rem;
      }
      
      .card {
        padding: 1rem;
        border-radius: var(--radius-sm);
      }
      
      .cris-card,
      .tip-card,
      .resource-card {
        padding: 1rem;
      }
      
      .support-section {
        flex-direction: column;
        gap: 0.5rem;
        align-items: flex-start;
      }
      
      .breathing-circle {
        width: 120px;
        height: 120px;
      }
      
      .breathing-controls {
        flex-direction: column;
        align-items: center;
      }
    }

    @media (max-width: 360px) {
      .hero h1 {
        font-size: 1.5rem;
      }
      
      .hero p {
        font-size: 0.9rem;
      }
      
      .site-title {
        font-size: 1.2rem;
      }
      
      .stat-card {
        padding: 0.75rem;
      }
      
      .stat-number {
        font-size: 1.5rem;
      }
    }

    @media (min-width: 1400px) {
      .header-content,
      section {
        max-width: 1400px;
        margin: 0 auto;
      }
      
      .hero h1 {
        font-size: 3.5rem;
      }
      
      .stats-container {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (hover: none) and (pointer: coarse) {
      button, 
      .nav-link, 
      .mood-option, 
      .support-btn {
        min-height: 44px;
        min-width: 44px;
      }
      
      input, 
      textarea {
        font-size: 16px;
      }
      
      .chat-actions button {
        padding: 0.75rem 1rem;
      }
    }
  </style>
</head>
<body>

  <!-- Modal connexion / inscription -->
  <div id="auth-modal" class="modal">
    <div class="modal-content fade-in">
      <div style="width: 80px; height: 80px; background: var(--primary-light); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: var(--primary); font-size: 2rem;">
        <i class="fas fa-heart"></i>
      </div>
      <h2>Bienvenue parmi nous</h2>
      <p>Rejoignez notre communaut√© bienveillante et exprimez-vous librement</p>
      <input type="text" id="login-pseudo" placeholder="Votre pseudonyme (2‚Äì20 caract√®res)">
      <input type="password" id="login-password" placeholder="Mot de passe (3 caract√®res minimum)">
      <button id="login-btn">
        <i class="fas fa-sign-in-alt"></i> Se connecter
      </button>
      <button id="signup-btn" class="btn-secondary">
        <i class="fas fa-user-plus"></i> Cr√©er un compte
      </button>
      <div id="auth-error" class="error"></div>
    </div>
  </div>

  <header>
    <div class="header-content">
      <h1 class="site-title">
        <i class="fas fa-heart"></i> Murmures du C≈ìur
      </h1>
      
      <button class="menu-toggle" id="menu-toggle">
        <i class="fas fa-bars"></i>
      </button>
      
      <nav id="main-nav">
        <ul>
          <li><a href="#" class="nav-link active" data-page="home"><i class="fas fa-home"></i></a></li>
          <li><a href="#" class="nav-link" data-page="chat" id="chat-nav-link">
            <i class="fas fa-comments"></i> 
            <span id="chat-notification" class="notification-badge hidden">0</span>
          </a></li>
          <li><a href="#" class="nav-link" data-page="cris" id="cris-nav-link">
            <i class="fas fa-volume-up"></i> 
            <span id="cris-notification" class="notification-badge hidden">0</span>
          </a></li>
          <li><a href="#" class="nav-link" data-page="publications"><i class="fas fa-newspaper"></i></a></li>
          <li><a href="#" class="nav-link" data-page="notifications" id="notifications-nav-link">
            <i class="fas fa-bell"></i> 
            <span id="notifications-badge" class="notification-badge hidden">0</span>
          </a></li>
          <li><a href="#" class="nav-link" data-page="resources"><i class="fas fa-hands-helping"></i> Ressources</a></li>
          
          <li class="user-menu">
            <div id="user-info" class="user-info hidden">
              <i class="fas fa-user"></i> 
              <span id="user-display"></span>
              <span id="user-mood" class="user-mood"></span>
              <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
            </div>
            <div class="user-dropdown" id="user-dropdown">
              <a href="#" id="admin-link" class="hidden">
                <i class="fas fa-cog"></i> Administration
              </a>
              <a href="#" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Se d√©connecter
              </a>
            </div>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <section id="home" class="active fade-in">
    <div class="hero">
      <h1>Votre sanctuaire √©motionnel</h1>
      <p>Un espace s√ªr pour partager vos sentiments, trouver du soutien et vous connecter avec des personnes bienveillantes</p>
      <button class="btn-secondary" style="width: auto; display: inline-flex;" id="start-sharing-btn">
        <i class="fas fa-feather"></i> Commencer √† partager
      </button>
    </div>

    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-number" id="users-count">0</div>
        <div class="stat-label">Membres bienveillants</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="messages-count">0</div>
        <div class="stat-label">Messages partag√©s</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="cris-count">0</div>
        <div class="stat-label">Cris du c≈ìur</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="support-count">24/7</div>
        <div class="stat-label">Soutien disponible</div>
      </div>
    </div>

    <div class="card" id="expression-section">
      <h2><i class="fas fa-feather"></i> Exprime ce que tu ressens</h2>
      <p>Choisissez comment vous souhaitez partager votre message :</p>
      
      <div class="privacy-options">
        <div class="privacy-option">
          <input type="radio" id="private" name="privacy" value="private" checked>
          <label for="private">
            <span class="radio-icon"></span>
            <i class="fas fa-lock"></i>
            <div>
              <div style="font-weight: 600;">Message priv√©</div>
              <div style="font-size: 0.8rem; color: var(--text-light);">Envoy√© directement √† notre √©quipe</div>
            </div>
          </label>
        </div>
        <div class="privacy-option">
          <input type="radio" id="public" name="privacy" value="public">
          <label for="public">
            <span class="radio-icon"></span>
            <i class="fas fa-globe"></i>
            <div>
              <div style="font-weight: 600;">Cri du c≈ìur</div>
              <div style="font-size: 0.8rem; color: var(--text-light);">Partag√© avec la communaut√©</div>
            </div>
          </label>
        </div>
      </div>

      <form id="personal-form">
        <textarea id="personal-message" placeholder="√âcris ici ce qui t'habite le c≈ìur... Tes mots seront accueillis avec bienveillance ‚ù§Ô∏è" rows="5"></textarea>
        <button type="submit">
          <i class="fas fa-paper-plane"></i> Partager mon message
        </button>
      </form>
    </div>

    <div class="mood-tracker">
      <h3><i class="fas fa-smile"></i> Comment vous sentez-vous aujourd'hui ?</h3>
      <div class="mood-options">
        <div class="mood-option" data-mood="excellent">
          <span class="mood-emoji">üòä</span>
          <span>Bien</span>
        </div>
        <div class="mood-option" data-mood="good">
          <span class="mood-emoji">üòå</span>
          <span>Serein</span>
        </div>
        <div class="mood-option" data-mood="neutral">
          <span class="mood-emoji">üòê</span>
          <span>Neutre</span>
        </div>
        <div class="mood-option" data-mood="bad">
          <span class="mood-emoji">üòî</span>
          <span>Triste</span>
        </div>
        <div class="mood-option" data-mood="terrible">
          <span class="mood-emoji">üò¢</span>
          <span>Accabl√©</span>
        </div>
      </div>
    </div>

    <div class="tips-container">
      <div class="tip-card">
        <div class="tip-icon">
          <i class="fas fa-hands-helping"></i>
        </div>
        <h3>Bienveillance</h3>
        <p>Chaque message est accueilli sans jugement. Nous √©coutons et soutenons.</p>
      </div>
      <div class="tip-card">
        <div class="tip-icon">
          <i class="fas fa-shield-alt"></i>
        </div>
        <h3>Confidentialit√©</h3>
        <p>Votre anonymat est pr√©serv√©. Partagez en toute tranquillit√© d'esprit.</p>
      </div>
      <div class="tip-card">
        <div class="tip-icon">
          <i class="fas fa-heartbeat"></i>
        </div>
        <h3>Soutien √©motionnel</h3>
        <p>Une communaut√© √† l'√©coute pour vous accompagner dans vos moments.</p>
      </div>
    </div>
  </section>

  <section id="chat">
    <div class="card">
      <h2><i class="fas fa-comments"></i> Espace de discussion</h2>
      <p>√âchangez avec la communaut√© dans un cadre respectueux et bienveillant</p>
      
      <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i> Chargement des messages‚Ä¶
          </div>
        </div>
        
        <div id="edit-mode-banner" class="edit-mode-banner hidden">
          <i class="fas fa-edit"></i> Mode √©dition activ√©
          <button onclick="cancelEdit()" style="background: white; color: var(--warning); margin-left: 1rem; padding: 0.3rem 0.8rem; border: none; border-radius: 6px; font-size: 0.8rem;">
            Annuler
          </button>
        </div>
        
        <div class="chat-input-container">
          <form id="chat-form">
            <textarea id="chat-text" placeholder="Partagez vos pens√©es avec la communaut√©..." rows="3"></textarea>
            <button type="submit" id="chat-submit">
              <i class="fas fa-paper-plane"></i> Envoyer
            </button>
          </form>
        </div>
      </div>
    </div>
  </section>

  <section id="cris">
    <div class="card">
      <h2><i class="fas fa-volume-up"></i> Les Cris du C≈ìur</h2>
      <p>Messages de soutien partag√©s par la communaut√©. Exprimez votre solidarit√©.</p>
      
      <div class="cris-grid" id="cris-grid">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Chargement des cris du c≈ìur‚Ä¶
        </div>
      </div>
    </div>
  </section>

  <section id="publications">
    <div class="card">
      <h2><i class="fas fa-newspaper"></i> Mes Publications</h2>
      <p>G√©rez vos messages partag√©s dans la section "Les Cris"</p>
      
      <div class="publications-grid" id="publications-grid">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Chargement de vos publications‚Ä¶
        </div>
      </div>
    </div>
  </section>

  <section id="resources">
    <div class="card">
      <h2><i class="fas fa-hands-helping"></i> Ressources de soutien</h2>
      <p>Des outils et ressources pour vous accompagner dans votre bien-√™tre √©motionnel</p>
      
      <div class="resources-grid">
        <div class="resource-card">
          <h3><i class="fas fa-book"></i> Journal √©motionnel</h3>
          <p>Tenir un journal de vos √©motions peut vous aider √† mieux les comprendre et les g√©rer.</p>
          <button class="btn-small" style="margin-top: 1rem;" onclick="showJournalPage()">
            <i class="fas fa-plus"></i> Commencer un journal
          </button>
        </div>
        
        <div class="resource-card">
          <h3><i class="fas fa-meditation"></i> Exercices de respiration</h3>
          <p>Des techniques simples pour calmer l'anxi√©t√© et retrouver votre centre.</p>
          <button class="btn-small" style="margin-top: 1rem;" onclick="showBreathingPage()">
            <i class="fas fa-play"></i> D√©marrer un exercice
          </button>
        </div>
        
        <div class="resource-card">
          <h3><i class="fas fa-heart"></i> Auto-compassion</h3>
          <p>Apprenez √† √™tre plus doux avec vous-m√™me dans les moments difficiles.</p>
          <button class="btn-small" style="margin-top: 1rem;" onclick="showDevelopmentMessage('Auto-compassion')">
            <i class="fas fa-book-open"></i> D√©couvrir
          </button>
        </div>
        
        <div class="resource-card">
          <h3><i class="fas fa-hand-holding-heart"></i> Lignes d'√©coute</h3>
          <p>Des professionnels sont disponibles si vous avez besoin de parler.</p>
          <button class="btn-small" style="margin-top: 1rem;" onclick="showDevelopmentMessage('Auto-compassion')">
            <i class="fas fa-phone"></i> Voir les contacts
          </button>
        </div>
      </div>
    </div>
  </section>

  <section id="notifications">
    <div class="card">
      <h2><i class="fas fa-bell"></i> Mes notifications</h2>
      <p>Retrouvez ici les r√©ponses de notre √©quipe √† vos messages priv√©s</p>
      
      <div class="notifications-container" id="notifications-container">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Chargement de vos notifications‚Ä¶
        </div>
      </div>
    </div>
  </section>

  <section id="admin" class="">
    <div class="card">
      <h2><i class="fas fa-cog"></i> Administration</h2>
      <p>Espace r√©serv√© √† l'administrateur pour r√©pondre aux messages priv√©s</p>
      
      <div class="admin-panel">
        <h3><i class="fas fa-envelope"></i> Messages priv√©s des utilisateurs</h3>
        
        <div class="admin-messages" id="admin-messages">
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i> Chargement des messages‚Ä¶
          </div>
        </div>
        
        <div id="admin-response-form" class="admin-response-form hidden">
          <h4>R√©pondre √† <span id="response-to"></span></h4>
          <textarea id="admin-response" placeholder="Votre r√©ponse √† l'utilisateur..." rows="4"></textarea>
          <button id="send-response">
            <i class="fas fa-paper-plane"></i> Envoyer la r√©ponse
          </button>
          <button class="btn-secondary" id="cancel-response">
            Annuler
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Pages pour les ressources -->
  <section id="journal-page" class="">
    <div class="card">
      <h2><i class="fas fa-book"></i> Mon Journal √âmotionnel</h2>
      <p>Exprimez librement vos pens√©es et √©motions. Ce journal est personnel et confidentiel.</p>
      
      <div class="journal-form">
        <h3><i class="fas fa-edit"></i> Nouvelle entr√©e</h3>
        <form id="journal-page-form">
          <textarea id="journal-page-entry" placeholder="Comment vous sentez-vous aujourd'hui ? Quelles sont vos pens√©es, vos √©motions ?..." rows="6"></textarea>
          <button type="submit">
            <i class="fas fa-save"></i> Enregistrer cette entr√©e
          </button>
        </form>
      </div>
      
      <div class="journal-entries" id="journal-page-entries">
        <h3><i class="fas fa-history"></i> Mes entr√©es pr√©c√©dentes</h3>
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Chargement de vos entr√©es‚Ä¶
        </div>
      </div>
      
      <button class="btn-secondary" onclick="backToResources()" style="margin-top: 2rem;">
        <i class="fas fa-arrow-left"></i> Retour aux ressources
      </button>
    </div>
  </section>

  <section id="breathing-page" class="">
    <div class="card">
      <h2><i class="fas fa-meditation"></i> Exercices de Respiration</h2>
      <p>Des techniques simples pour calmer l'anxi√©t√© et retrouver votre centre.</p>
      
      <div class="breathing-exercise">
        <h3>Exercice de respiration calmante</h3>
        <p>Cette technique de respiration 4-7-8 peut aider √† r√©duire l'anxi√©t√© et favoriser la relaxation.</p>
        
        <div class="breathing-instructions" id="breathing-page-instructions">
          Pr√™t √† commencer ? Cliquez sur D√©marrer.
        </div>
        
        <div class="breathing-circle" id="breathing-page-circle">
          Respirez
        </div>
        
        <div class="breathing-controls">
          <button id="start-breathing-page" class="btn-small">
            <i class="fas fa-play"></i> D√©marrer
          </button>
          <button id="pause-breathing-page" class="btn-small btn-secondary" disabled>
            <i class="fas fa-pause"></i> Pause
          </button>
          <button id="reset-breathing-page" class="btn-small btn-secondary">
            <i class="fas fa-redo"></i> R√©initialiser
          </button>
        </div>
        
        <div style="margin-top: 2rem;">
          <h4>Comment pratiquer la respiration 4-7-8 :</h4>
          <ol style="text-align: left; margin-top: 1rem;">
            <li>Inspirez profond√©ment par le nez en comptant jusqu'√† 4</li>
            <li>Retenez votre souffle en comptant jusqu'√† 7</li>
            <li>Expirez lentement par la bouche en comptant jusqu'√† 8</li>
            <li>R√©p√©tez ce cycle 3 √† 5 fois</li>
          </ol>
        </div>
      </div>
      
      <button class="btn-secondary" onclick="backToResources()" style="margin-top: 2rem;">
        <i class="fas fa-arrow-left"></i> Retour aux ressources
      </button>
    </div>
  </section>

  <section id="development-page" class="">
    <div class="card">
      <h2 id="development-title"></h2>
      <div class="development-message">
        <i class="fas fa-tools"></i>
        <h3>Fonctionnalit√© en cours de d√©veloppement</h3>
        <p>Cette section est actuellement en cours de d√©veloppement.</p>
        <p>Nous travaillons √† vous offrir la meilleure exp√©rience possible.</p>
        <p>Revenez bient√¥t pour d√©couvrir cette nouvelle fonctionnalit√© !</p>
      </div>
      
      <button class="btn-secondary" onclick="backToResources()" style="margin-top: 2rem;">
        <i class="fas fa-arrow-left"></i> Retour aux ressources
      </button>
    </div>
  </section>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDqNGfyizePPtiLDME9Z6OkncRaxWWNAvE",
      authDomain: "murmuresducoeur.firebaseapp.com",
      databaseURL: "https://murmuresducoeur-default-rtdb.firebaseio.com",
      projectId: "murmuresducoeur",
      storageBucket: "murmuresducoeur.firebasestorage.app",
      messagingSenderId: "459129346137",
      appId: "1:459129346137:web:5850d7536a8242d7473948"
    };

    // Initialisation Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // R√©f√©rences Firebase
    const usersRef = db.ref('users');
    const chatRef = db.ref('chat');
    const crisRef = db.ref('cris');
    const supportsRef = db.ref('supports');
    const userReadTimesRef = db.ref('user_read_times');
    const userMoodsRef = db.ref('user_moods');
    const privateMessagesRef = db.ref('private_messages');
    const journalRef = db.ref('journal');
    const notificationsRef = db.ref('notifications');

    function hashPassword(pseudo, password) {
      return btoa(pseudo + '|' + password).substring(0, 32);
    }

    let currentUser = null;
    let currentEditKey = null;
    let lastDate = null;
    let unreadMessagesCount = 0;
    let unreadCrisCount = 0;
    let unreadNotificationsCount = 0;
    let lastReadTime = 0;
    let lastCrisReadTime = 0;
    let currentUserMood = null;
    let breathingInterval = null;
    let breathingStep = 0;
    let isBreathingActive = false;
    let currentResponseTo = null;

    // === FONCTIONS DE NAVIGATION POUR LES NOUVELLES PAGES ===
    window.showJournalPage = function() {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.getElementById('journal-page').classList.add('active');
      loadJournalPageEntries();
    };
    
    window.showBreathingPage = function() {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.getElementById('breathing-page').classList.add('active');
      resetBreathingPage();
    };
    
    window.showDevelopmentMessage = function(title) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.getElementById('development-title').textContent = title;
      document.getElementById('development-page').classList.add('active');
    };
    
    window.backToResources = function() {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.getElementById('resources').classList.add('active');
      document.querySelector('[data-page="resources"]').classList.add('active');
    };

    // === FONCTIONS POUR LE JOURNAL EMOTIONNEL ===
    function loadJournalPageEntries() {
      const journalEntries = document.getElementById('journal-page-entries');
      journalEntries.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement de vos entr√©es‚Ä¶</div>';
      
      if (!currentUser) return;
      
      journalRef.orderByChild('user').equalTo(currentUser.pseudo).once('value', (snapshot) => {
        const entries = snapshot.val() || {};
        const entriesArray = Object.entries(entries)
          .map(([key, value]) => ({ key, ...value }))
          .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        journalEntries.innerHTML = '';
        
        if (entriesArray.length === 0) {
          journalEntries.innerHTML = '<div class="text-muted" style="text-align: center; padding: 2rem;">Vous n\'avez pas encore d\'entr√©es dans votre journal.</div>';
          return;
        }
        
        entriesArray.forEach(entry => {
          displayJournalPageEntry(entry);
        });
      });
    }
    
    function displayJournalPageEntry(entry) {
      const journalEntries = document.getElementById('journal-page-entries');
      const entryDate = new Date(entry.timestamp || Date.now());
      const dateString = entryDate.toLocaleDateString('fr-FR', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      const timeString = entryDate.toLocaleTimeString('fr-FR', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      const entryDiv = document.createElement('div');
      entryDiv.className = 'journal-entry';
      entryDiv.dataset.key = entry.key;
      
      entryDiv.innerHTML = `
        <div class="journal-entry-header">
          <strong>${dateString}</strong>
          <span>${timeString}</span>
        </div>
        <div class="journal-entry-content">${entry.text}</div>
        <div class="journal-entry-actions">
          <button class="btn-small btn-secondary" onclick="deleteJournalPageEntry('${entry.key}')">
            <i class="fas fa-trash"></i> Supprimer
          </button>
        </div>
      `;
      
      journalEntries.appendChild(entryDiv);
    }
    
    // Soumission du formulaire de journal
    document.getElementById('journal-page-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const text = document.getElementById('journal-page-entry').value.trim();
      
      if (!text || !currentUser) return;
      
      const newEntry = {
        user: currentUser.pseudo,
        text: text,
        timestamp: Date.now()
      };
      
      journalRef.push(newEntry).then(() => {
        document.getElementById('journal-page-entry').value = '';
        loadJournalPageEntries();
      });
    });
    
    // Suppression d'une entr√©e de journal
    window.deleteJournalPageEntry = function(key) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer cette entr√©e de journal ?')) {
        db.ref('journal/' + key).remove();
        loadJournalPageEntries();
      }
    };

    // === FONCTIONS POUR LES EXERCICES DE RESPIRATION ===
    // D√©marrer l'exercice de respiration
    document.getElementById('start-breathing-page').addEventListener('click', () => {
      if (isBreathingActive) return;
      
      isBreathingActive = true;
      document.getElementById('start-breathing-page').disabled = true;
      document.getElementById('pause-breathing-page').disabled = false;
      breathingStep = 0;
      
      startBreathingPageCycle();
    });
    
    // Mettre en pause l'exercice de respiration
    document.getElementById('pause-breathing-page').addEventListener('click', () => {
      if (!isBreathingActive) return;
      
      isBreathingActive = false;
      document.getElementById('start-breathing-page').disabled = false;
      document.getElementById('pause-breathing-page').disabled = true;
      
      clearInterval(breathingInterval);
      document.getElementById('breathing-page-instructions').textContent = "Exercice en pause";
      document.getElementById('breathing-page-circle').classList.remove('active');
      document.getElementById('breathing-page-circle').textContent = "Pause";
    });
    
    // R√©initialiser l'exercice de respiration
    document.getElementById('reset-breathing-page').addEventListener('click', () => {
      resetBreathingPage();
    });
    
    function startBreathingPageCycle() {
      const circle = document.getElementById('breathing-page-circle');
      const instructions = document.getElementById('breathing-page-instructions');
      
      breathingInterval = setInterval(() => {
        breathingStep++;
        
        if (breathingStep <= 4) {
          // Inspiration (4 secondes)
          instructions.textContent = `Inspirez... (${breathingStep}/4)`;
          if (breathingStep === 4) {
            circle.classList.add('active');
            circle.textContent = "Retenez";
          } else {
            circle.textContent = "Inspirez";
          }
        } else if (breathingStep <= 11) {
          // R√©tention (7 secondes)
          instructions.textContent = `Retenez votre souffle... (${breathingStep - 4}/7)`;
          if (breathingStep === 11) {
            circle.classList.remove('active');
            circle.textContent = "Expirez";
          }
        } else if (breathingStep <= 19) {
          // Expiration (8 secondes)
          instructions.textContent = `Expirez... (${breathingStep - 11}/8)`;
          if (breathingStep === 19) {
            // Recommencer le cycle
            breathingStep = 0;
            instructions.textContent = "Recommencez...";
            circle.textContent = "Inspirez";
          }
        }
      }, 1000);
    }
    
    function resetBreathingPage() {
      isBreathingActive = false;
      clearInterval(breathingInterval);
      document.getElementById('start-breathing-page').disabled = false;
      document.getElementById('pause-breathing-page').disabled = true;
      document.getElementById('breathing-page-instructions').textContent = "Pr√™t √† commencer ? Cliquez sur D√©marrer.";
      document.getElementById('breathing-page-circle').classList.remove('active');
      document.getElementById('breathing-page-circle').textContent = "Respirez";
      breathingStep = 0;
    }

    // === GESTION DU MENU RESPONSIVE ===
    document.addEventListener('DOMContentLoaded', function() {
      const menuToggle = document.getElementById('menu-toggle');
      const mainNav = document.getElementById('main-nav');
      const userInfo = document.getElementById('user-info');
      const userDropdown = document.getElementById('user-dropdown');

      // Toggle menu mobile
      if (menuToggle) {
        menuToggle.addEventListener('click', function() {
          mainNav.classList.toggle('active');
          menuToggle.innerHTML = mainNav.classList.contains('active') 
            ? '<i class="fas fa-times"></i>' 
            : '<i class="fas fa-bars"></i>';
        });
      }

      // Toggle dropdown utilisateur
      if (userInfo) {
        userInfo.addEventListener('click', function(e) {
          e.stopPropagation();
          userDropdown.classList.toggle('active');
        });
      }

      // Fermer le dropdown en cliquant ailleurs
      document.addEventListener('click', function() {
        userDropdown.classList.remove('active');
      });

      // Fermer le menu mobile au clic sur un lien
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function() {
          if (window.innerWidth <= 768) {
            mainNav.classList.remove('active');
            menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
          }
        });
      });

      // Adapter le menu au redimensionnement
      window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
          mainNav.classList.remove('active');
          menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
        }
      });
    });

    // === RESTAURER SESSION ===
    function restoreSession() {
      const saved = localStorage.getItem('murmures_user');
      if (saved) {
        try {
          currentUser = JSON.parse(saved);
          document.getElementById('user-display').textContent = currentUser.pseudo;
          document.getElementById('user-info').classList.remove('hidden');
          document.getElementById('auth-modal').classList.add('hidden');
          
          // Afficher le lien admin si l'utilisateur est l'admin
          if (currentUser.pseudo === "IamTheAdmin") {
            document.getElementById('admin-link').classList.remove('hidden');
          }
          
          initializeUserSession();
          return true;
        } catch (e) {
          console.error("Erreur restauration session:", e);
          localStorage.removeItem('murmures_user');
        }
      }
      return false;
    }

    // === INITIALISATION SESSION UTILISATEUR ===
    function initializeUserSession() {
      loadLastReadTimes();
      loadMessages();
      loadCris();
      loadPublications();
      updateStats();
      setupNotifications();
      setupMoodTracker();
      loadUserMood();
      loadNotifications();
      
      // Si l'utilisateur est admin, charger les messages priv√©s
      if (currentUser.pseudo === "IamTheAdmin") {
        loadPrivateMessagesForAdmin();
      }
    }

    // === CHARGEMENT DE L'HUMEUR UTILISATEUR ===
    function loadUserMood() {
      if (!currentUser) return;
      
      userMoodsRef.child(currentUser.pseudo).on('value', (snapshot) => {
        const moodData = snapshot.val();
        if (moodData) {
          currentUserMood = moodData.mood;
          updateUserMoodDisplay();
        }
      });
    }

    // === MISE √Ä JOUR DE L'AFFICHAGE DE L'HUMEUR ===
    function updateUserMoodDisplay() {
      const moodDisplay = document.getElementById('user-mood');
      if (!moodDisplay) return;

      const moodEmojis = {
        'excellent': 'üòä',
        'good': 'üòå',
        'neutral': 'üòê',
        'bad': 'üòî',
        'terrible': 'üò¢'
      };

      moodDisplay.textContent = currentUserMood ? moodEmojis[currentUserMood] || '' : '';
    }

    // === CHARGEMENT DES DERNIERS TEMPS DE LECTURE ===
    function loadLastReadTimes() {
      const chatReadTimeRef = db.ref(`user_read_times/${currentUser.pseudo}/chat`);
      const crisReadTimeRef = db.ref(`user_read_times/${currentUser.pseudo}/cris`);
      const notificationsReadTimeRef = db.ref(`user_read_times/${currentUser.pseudo}/notifications`);
      
      chatReadTimeRef.once('value', (snapshot) => {
        lastReadTime = snapshot.exists() ? snapshot.val() : Date.now();
        if (!snapshot.exists()) {
          chatReadTimeRef.set(lastReadTime);
        }
        updateUnreadCount();
      });
      
      crisReadTimeRef.once('value', (snapshot) => {
        lastCrisReadTime = snapshot.exists() ? snapshot.val() : Date.now();
        if (!snapshot.exists()) {
          crisReadTimeRef.set(lastCrisReadTime);
        }
        updateUnreadCrisCount();
      });
      
      notificationsReadTimeRef.once('value', (snapshot) => {
        const lastNotificationsReadTime = snapshot.exists() ? snapshot.val() : Date.now();
        if (!snapshot.exists()) {
          notificationsReadTimeRef.set(lastNotificationsReadTime);
        }
        updateUnreadNotificationsCount();
      });
    }

    // === MISE √Ä JOUR DES TEMPS DE LECTURE ===
    function updateReadTime(type) {
      const time = Date.now();
      const readTimeRef = db.ref(`user_read_times/${currentUser.pseudo}/${type}`);
      readTimeRef.set(time);
      
      if (type === 'chat') {
        lastReadTime = time;
        updateUnreadCount();
      } else if (type === 'cris') {
        lastCrisReadTime = time;
        updateUnreadCrisCount();
      } else if (type === 'notifications') {
        updateUnreadNotificationsCount();
      }
    }

    // === CONFIGURATION DES NOTIFICATIONS ===
    function setupNotifications() {
      // Notifications pour les messages de chat
      chatRef.on('child_added', (snapshot) => {
        const msg = snapshot.val();
        const messageTime = msg.timestamp || Date.now();
        
        if (messageTime > lastReadTime && msg.pseudo !== currentUser.pseudo) {
          updateUnreadCount();
        }
      });

      // Notifications pour les nouveaux cris
      crisRef.on('child_added', (snapshot) => {
        const cris = snapshot.val();
        const crisTime = cris.timestamp || Date.now();
        
        if (crisTime > lastCrisReadTime && cris.pseudo !== currentUser.pseudo) {
          updateUnreadCrisCount();
        }
      });
      
      // Notifications pour les r√©ponses de l'admin
      notificationsRef.on('child_added', (snapshot) => {
        const notification = snapshot.val();
        if (notification.to === currentUser.pseudo && !notification.read) {
          updateUnreadNotificationsCount();
        }
      });
      
      // Notifications pour les messages priv√©s (admin)
      privateMessagesRef.on('child_added', (snapshot) => {
        if (currentUser && currentUser.pseudo === "IamTheAdmin") {
          updateUnreadPrivateMessagesCount();
        }
      });
    }

    // === MISE √Ä JOUR DES COMPTEURS DE NOTIFICATIONS ===
    function updateUnreadCount() {
      chatRef.once('value', (snapshot) => {
        const messages = snapshot.val() || {};
        let unreadCount = 0;

        Object.values(messages).forEach(msg => {
          const messageTime = msg.timestamp || 0;
          if (messageTime > lastReadTime && msg.pseudo !== currentUser.pseudo) {
            unreadCount++;
          }
        });

        unreadMessagesCount = unreadCount;
        const notificationBadge = document.getElementById('chat-notification');
        
        if (unreadCount > 0) {
          notificationBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
          notificationBadge.classList.remove('hidden');
        } else {
          notificationBadge.classList.add('hidden');
        }
      });
    }

    function updateUnreadCrisCount() {
      crisRef.once('value', (snapshot) => {
        const cris = snapshot.val() || {};
        let unreadCount = 0;

        Object.values(cris).forEach(cri => {
          const criTime = cri.timestamp || 0;
          if (criTime > lastCrisReadTime && cri.pseudo !== currentUser.pseudo) {
            unreadCount++;
          }
        });

        unreadCrisCount = unreadCount;
        const notificationBadge = document.getElementById('cris-notification');
        
        if (unreadCount > 0) {
          notificationBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
          notificationBadge.classList.remove('hidden');
        } else {
          notificationBadge.classList.add('hidden');
        }
      });
    }
    
    function updateUnreadNotificationsCount() {
      if (!currentUser) return;
      
      notificationsRef.orderByChild('to').equalTo(currentUser.pseudo).once('value', (snapshot) => {
        const notifications = snapshot.val() || {};
        let unreadCount = 0;

        Object.values(notifications).forEach(notification => {
          if (!notification.read) {
            unreadCount++;
          }
        });

        unreadNotificationsCount = unreadCount;
        const notificationBadge = document.getElementById('notifications-badge');
        
        if (unreadCount > 0) {
          notificationBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
          notificationBadge.classList.remove('hidden');
        } else {
          notificationBadge.classList.add('hidden');
        }
      });
    }
    
    function updateUnreadPrivateMessagesCount() {
      if (!currentUser || currentUser.pseudo !== "IamTheAdmin") return;
      
      privateMessagesRef.once('value', (snapshot) => {
        const messages = snapshot.val() || {};
        let unreadCount = 0;

        Object.values(messages).forEach(message => {
          if (!message.read) {
            unreadCount++;
          }
        });

        // Mettre √† jour le badge de l'admin
        const adminBadge = document.getElementById('admin-link');
        if (unreadCount > 0) {
          if (!adminBadge.querySelector('.notification-badge')) {
            const badge = document.createElement('span');
            badge.className = 'notification-badge';
            badge.id = 'admin-notification';
            badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
            adminBadge.appendChild(badge);
          } else {
            document.getElementById('admin-notification').textContent = unreadCount > 99 ? '99+' : unreadCount;
          }
        } else {
          const badge = adminBadge.querySelector('.notification-badge');
          if (badge) {
            badge.remove();
          }
        }
      });
    }

    // === MISE √Ä JOUR DES STATISTIQUES ===
    function updateStats() {
      usersRef.on('value', (snapshot) => {
        const users = snapshot.val() || {};
        document.getElementById('users-count').textContent = Object.keys(users).length;
      });

      chatRef.on('value', (snapshot) => {
        const messages = snapshot.val() || {};
        document.getElementById('messages-count').textContent = Object.keys(messages).length;
      });

      crisRef.on('value', (snapshot) => {
        const cris = snapshot.val() || {};
        document.getElementById('cris-count').textContent = Object.keys(cris).length;
      });
    }

    // === CONFIGURATION DU TRACKER D'HUMEUR ===
    function setupMoodTracker() {
      const moodOptions = document.querySelectorAll('.mood-option');
      
      moodOptions.forEach(option => {
        option.addEventListener('click', function() {
          const mood = this.getAttribute('data-mood');
          
          // Retirer la classe active de toutes les options
          moodOptions.forEach(opt => opt.classList.remove('active'));
          // Ajouter la classe active √† l'option s√©lectionn√©e
          this.classList.add('active');
          
          if (currentUser) {
            // Sauvegarder l'humeur de l'utilisateur
            userMoodsRef.child(currentUser.pseudo).set({
              mood: mood,
              timestamp: Date.now()
            }).then(() => {
              currentUserMood = mood;
              updateUserMoodDisplay();
              
              // Feedback visuel
              const originalBg = this.style.background;
              this.style.background = 'var(--success)';
              this.style.color = 'white';
              
              setTimeout(() => {
                this.style.background = originalBg;
                this.style.color = '';
              }, 1000);
            });
          }
        });
      });
    }

    // === D√âCONNEXION ===
    document.getElementById('logout-btn').addEventListener('click', (e) => {
      e.preventDefault();
      currentUser = null;
      currentEditKey = null;
      lastDate = null;
      unreadMessagesCount = 0;
      unreadCrisCount = 0;
      unreadNotificationsCount = 0;
      lastReadTime = 0;
      lastCrisReadTime = 0;
      currentUserMood = null;
      localStorage.removeItem('murmures_user');
      document.getElementById('user-info').classList.add('hidden');
      document.getElementById('auth-modal').classList.remove('hidden');
      document.getElementById('chat-messages').innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement des messages‚Ä¶</div>';
      document.getElementById('cris-grid').innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement des cris du c≈ìur‚Ä¶</div>';
      document.getElementById('publications-grid').innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement de vos publications‚Ä¶</div>';
      document.getElementById('chat-notification').classList.add('hidden');
      document.getElementById('cris-notification').classList.add('hidden');
      document.getElementById('notifications-badge').classList.add('hidden');
      document.getElementById('admin-link').classList.add('hidden');
      cancelEdit();
      resetBreathingPage();
    });

    // V√©rifier la session au chargement
    document.addEventListener('DOMContentLoaded', () => {
      if (!restoreSession()) {
        document.getElementById('auth-modal').classList.remove('hidden');
      }
    });

    // === BOUTON "COMMENCER √Ä PARTAGER" ===
    document.getElementById('start-sharing-btn').addEventListener('click', () => {
      document.getElementById('expression-section').scrollIntoView({ 
        behavior: 'smooth' 
      });
    });

    // === INSCRIPTION ===
    document.getElementById('signup-btn').addEventListener('click', () => {
      const pseudo = document.getElementById('login-pseudo').value.trim();
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('auth-error');
      errorDiv.textContent = '';

      if (!pseudo || pseudo.length < 2 || pseudo.length > 20) {
        errorDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Pseudonyme : 2 √† 20 caract√®res.';
        return;
      }
      if (!password || password.length < 3) {
        errorDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Mot de passe : au moins 3 caract√®res.';
        return;
      }

      const userRef = db.ref('users/' + pseudo);
      userRef.once('value', (snapshot) => {
        if (snapshot.exists()) {
          errorDiv.innerHTML = '<i class="fas fa-user-times"></i> Ce pseudonyme est d√©j√† pris.';
        } else {
          const hash = hashPassword(pseudo, password);
          userRef.set({ 
            password: hash, 
            created: Date.now(),
            lastLogin: Date.now()
          }).then(() => {
            currentUser = { pseudo, password: hash };
            localStorage.setItem('murmures_user', JSON.stringify(currentUser));
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('user-display').textContent = pseudo;
            document.getElementById('user-info').classList.remove('hidden');
            
            // Afficher le lien admin si l'utilisateur est l'admin
            if (currentUser.pseudo === "IamTheAdmin") {
              document.getElementById('admin-link').classList.remove('hidden');
            }
            
            errorDiv.innerHTML = '<i class="fas fa-check-circle"></i> Inscription r√©ussie!';
            initializeUserSession();
          }).catch((error) => {
            console.error("Inscription √©chou√©e :", error);
            errorDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Erreur: ' + (error.message || "Probl√®me de connexion √† la base de donn√©es");
          });
        }
      });
    });

    // === CONNEXION ===
    document.getElementById('login-btn').addEventListener('click', () => {
      const pseudo = document.getElementById('login-pseudo').value.trim();
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('auth-error');
      errorDiv.textContent = '';

      if (!pseudo || !password) {
        errorDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Veuillez remplir tous les champs.';
        return;
      }

      const userRef = db.ref('users/' + pseudo);
      userRef.once('value', (snapshot) => {
        if (!snapshot.exists()) {
          errorDiv.innerHTML = '<i class="fas fa-user-times"></i> Pseudonyme introuvable.';
        } else {
          const hash = hashPassword(pseudo, password);
          const userData = snapshot.val();
          
          if (userData.password === hash) {
            userRef.update({
              lastLogin: Date.now()
            }).then(() => {
              currentUser = { pseudo, password: hash };
              localStorage.setItem('murmures_user', JSON.stringify(currentUser));
              document.getElementById('auth-modal').classList.add('hidden');
              document.getElementById('user-display').textContent = pseudo;
              document.getElementById('user-info').classList.remove('hidden');
              
              // Afficher le lien admin si l'utilisateur est l'admin
              if (currentUser.pseudo === "IamTheAdmin") {
                document.getElementById('admin-link').classList.remove('hidden');
              }
              
              errorDiv.innerHTML = '<i class="fas fa-check-circle"></i> Connexion r√©ussie!';
              initializeUserSession();
            });
          } else {
            errorDiv.innerHTML = '<i class="fas fa-lock"></i> Mot de passe incorrect.';
          }
        }
      });
    });

    // === NAVIGATION ===
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const page = link.getAttribute('data-page');
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        document.getElementById(page).classList.add('active');
        document.getElementById(page).classList.add('fade-in');

        // Mettre √† jour le temps de lecture selon la page
        if (page === 'chat') {
          updateReadTime('chat');
        } else if (page === 'cris') {
          updateReadTime('cris');
        } else if (page === 'notifications') {
          updateReadTime('notifications');
          markNotificationsAsRead();
        }
      });
    });
    
    // === NAVIGATION ADMIN ===
    document.getElementById('admin-link').addEventListener('click', (e) => {
      e.preventDefault();
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.getElementById('admin').classList.add('active');
      loadPrivateMessagesForAdmin();
    });

    // === CHARGEMENT DES MESSAGES ===
    function loadMessages() {
      const chatMessages = document.getElementById('chat-messages');
      chatMessages.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement des messages‚Ä¶</div>';
      
      // Charger les humeurs des utilisateurs
      const userMoods = {};
      userMoodsRef.once('value').then((snapshot) => {
        const moods = snapshot.val() || {};
        Object.keys(moods).forEach(username => {
          userMoods[username] = moods[username].mood;
        });
      });

      chatRef.orderByChild('timestamp').on('value', (snapshot) => {
        const messages = snapshot.val() || {};
        const messagesArray = Object.entries(messages)
          .map(([key, value]) => ({ key, ...value }))
          .sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
        
        chatMessages.innerHTML = '';
        lastDate = null;
        
        if (messagesArray.length === 0) {
          chatMessages.innerHTML = '<div class="text-muted" style="text-align: center; padding: 2rem;">Aucun message pour le moment. Soyez le premier √† partager !</div>';
          return;
        }
        
        messagesArray.forEach(msg => {
          displayMessage(msg, userMoods);
        });
        
        chatMessages.scrollTop = chatMessages.scrollHeight;
      });
    }

    function displayMessage(msg, userMoods = {}) {
      const chatMessages = document.getElementById('chat-messages');
      const messageDate = new Date(msg.timestamp || Date.now());
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      let dateLabel = '';
      if (!lastDate || lastDate.toDateString() !== messageDate.toDateString()) {
        if (messageDate.toDateString() === today.toDateString()) {
          dateLabel = "Aujourd'hui";
        } else if (messageDate.toDateString() === yesterday.toDateString()) {
          dateLabel = 'Hier';
        } else {
          dateLabel = messageDate.toLocaleDateString('fr-FR', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          });
        }
        
        const dateSeparator = document.createElement('div');
        dateSeparator.className = 'date-separator';
        dateSeparator.innerHTML = `<span class="date-label">${dateLabel}</span>`;
        chatMessages.appendChild(dateSeparator);
        
        lastDate = messageDate;
      }
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${msg.pseudo === currentUser.pseudo ? 'own' : 'other'}`;
      messageDiv.dataset.key = msg.key;
      
      const timeString = messageDate.toLocaleTimeString('fr-FR', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });

      // R√©cup√©rer l'humeur de l'utilisateur
      const userMood = userMoods[msg.pseudo];
      const moodEmojis = {
        'excellent': 'üòä',
        'good': 'üòå',
        'neutral': 'üòê',
        'bad': 'üòî',
        'terrible': 'üò¢'
      };
      const moodEmoji = userMood ? moodEmojis[userMood] : '';
      
      messageDiv.innerHTML = `
        <div class="chat-pseudo">
          <i class="fas fa-user"></i> ${msg.pseudo}
          ${moodEmoji ? `<span class="user-mood">${moodEmoji}</span>` : ''}
        </div>
        <div class="chat-text">${msg.text}</div>
        <div class="chat-time" style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">${timeString}</div>
        ${msg.pseudo === currentUser.pseudo ? `
          <div class="chat-actions">
            <button class="btn-edit" onclick="editMessage('${msg.key}', '${msg.text.replace(/'/g, "\\'")}')">
              <i class="fas fa-edit"></i> Modifier
            </button>
            <button class="btn-delete" onclick="deleteMessage('${msg.key}')">
              <i class="fas fa-trash"></i> Supprimer
            </button>
          </div>
        ` : ''}
      `;
      
      chatMessages.appendChild(messageDiv);
    }

    // === ENVOI DE MESSAGE ===
    document.getElementById('chat-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const text = document.getElementById('chat-text').value.trim();
      
      if (!text || !currentUser) return;
      
      if (currentEditKey) {
        // Mode √©dition
        const updates = {};
        updates[`chat/${currentEditKey}/text`] = text;
        updates[`chat/${currentEditKey}/edited`] = true;
        updates[`chat/${currentEditKey}/editTimestamp`] = Date.now();
        
        db.ref().update(updates).then(() => {
          document.getElementById('chat-text').value = '';
          cancelEdit();
        });
      } else {
        // Nouveau message
        const newMessage = {
          pseudo: currentUser.pseudo,
          text: text,
          timestamp: Date.now()
        };
        
        chatRef.push(newMessage).then(() => {
          document.getElementById('chat-text').value = '';
        });
      }
    });

    // === √âDITION DE MESSAGE ===
    window.editMessage = function(key, text) {
      currentEditKey = key;
      document.getElementById('chat-text').value = text;
      document.getElementById('edit-mode-banner').classList.remove('hidden');
      document.getElementById('chat-submit').innerHTML = '<i class="fas fa-save"></i> Mettre √† jour';
      document.getElementById('chat-text').focus();
    };

    window.cancelEdit = function() {
      currentEditKey = null;
      document.getElementById('chat-text').value = '';
      document.getElementById('edit-mode-banner').classList.add('hidden');
      document.getElementById('chat-submit').innerHTML = '<i class="fas fa-paper-plane"></i> Envoyer';
    };

    // === SUPPRESSION DE MESSAGE ===
    window.deleteMessage = function(key) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer ce message ?')) {
        db.ref('chat/' + key).remove();
      }
    };

    // === CHARGEMENT DES CRIS ===
    function loadCris() {
      const crisGrid = document.getElementById('cris-grid');
      crisGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement des cris du c≈ìur‚Ä¶</div>';
      
      crisRef.on('value', (snapshot) => {
        const cris = snapshot.val() || {};
        const crisArray = Object.entries(cris)
          .map(([key, value]) => ({ key, ...value }))
          .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        crisGrid.innerHTML = '';
        
        if (crisArray.length === 0) {
          crisGrid.innerHTML = '<div class="text-muted" style="text-align: center; padding: 2rem; grid-column: 1 / -1;">Aucun cri du c≈ìur pour le moment. Soyez le premier √† partager !</div>';
          return;
        }
        
        crisArray.forEach(cri => {
          displayCri(cri);
        });
      });
    }

    function displayCri(cri) {
      const crisGrid = document.getElementById('cris-grid');
      const criDate = new Date(cri.timestamp || Date.now());
      const timeString = criDate.toLocaleDateString('fr-FR') + ' √† ' + criDate.toLocaleTimeString('fr-FR', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      const criCard = document.createElement('div');
      criCard.className = 'cris-card';
      criCard.dataset.key = cri.key;
      
      criCard.innerHTML = `
        <div class="cris-meta">
          <strong>${cri.pseudo}</strong>
          <span class="text-muted">${timeString}</span>
        </div>
        <div class="cris-content">${cri.text}</div>
        <div class="support-section">
          <button class="support-btn" onclick="toggleSupport('${cri.key}')">
            <i class="fas fa-heart"></i> Soutenir
          </button>
          <span class="support-count" id="support-count-${cri.key}">${cri.supportCount || 0}</span>
        </div>
        ${cri.pseudo === currentUser.pseudo ? `
          <div class="cris-actions">
            <button class="action-btn delete" onclick="deleteCri('${cri.key}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        ` : ''}
      `;
      
      crisGrid.appendChild(criCard);
      
      // V√©rifier si l'utilisateur a d√©j√† soutenu ce cri
      checkUserSupport(cri.key);
    }

    // === SUPPORT DES CRIS ===
    window.toggleSupport = function(criKey) {
      if (!currentUser) return;
      
      const supportRef = db.ref(`supports/${criKey}/${currentUser.pseudo}`);
      
      supportRef.once('value').then((snapshot) => {
        if (snapshot.exists()) {
          // Retirer le support
          supportRef.remove().then(() => {
            updateSupportCount(criKey);
          });
        } else {
          // Ajouter le support
          supportRef.set({
            timestamp: Date.now()
          }).then(() => {
            updateSupportCount(criKey);
          });
        }
      });
    };

    function checkUserSupport(criKey) {
      if (!currentUser) return;
      
      const supportRef = db.ref(`supports/${criKey}/${currentUser.pseudo}`);
      supportRef.once('value').then((snapshot) => {
        const supportBtn = document.querySelector(`[onclick="toggleSupport('${criKey}')"]`);
        if (snapshot.exists()) {
          supportBtn.classList.add('active');
          supportBtn.innerHTML = '<i class="fas fa-heart"></i> Soutenu';
        } else {
          supportBtn.classList.remove('active');
          supportBtn.innerHTML = '<i class="fas fa-heart"></i> Soutenir';
        }
      });
    }

    function updateSupportCount(criKey) {
      const supportRef = db.ref(`supports/${criKey}`);
      supportRef.once('value').then((snapshot) => {
        const supportCount = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
        
        // Mettre √† jour dans la base de donn√©es
        db.ref(`cris/${criKey}/supportCount`).set(supportCount);
        
        // Mettre √† jour l'affichage
        const supportCountElement = document.getElementById(`support-count-${criKey}`);
        if (supportCountElement) {
          supportCountElement.textContent = supportCount;
        }
      });
    }

    // === SUPPRESSION D'UN CRI ===
    window.deleteCri = function(key) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer ce cri du c≈ìur ?')) {
        db.ref('cris/' + key).remove();
        // Supprimer √©galement les supports associ√©s
        db.ref('supports/' + key).remove();
      }
    };

    // === CHARGEMENT DES PUBLICATIONS ===
    function loadPublications() {
      const publicationsGrid = document.getElementById('publications-grid');
      publicationsGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement de vos publications‚Ä¶</div>';
      
      if (!currentUser) return;
      
      crisRef.on('value', (snapshot) => {
        const cris = snapshot.val() || {};
        const userCris = Object.entries(cris)
          .map(([key, value]) => ({ key, ...value }))
          .filter(cri => cri.pseudo === currentUser.pseudo)
          .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        publicationsGrid.innerHTML = '';
        
        if (userCris.length === 0) {
          publicationsGrid.innerHTML = '<div class="text-muted" style="text-align: center; padding: 2rem; grid-column: 1 / -1;">Vous n\'avez pas encore publi√© de cri du c≈ìur.</div>';
          return;
        }
        
        userCris.forEach(cri => {
          displayPublication(cri);
        });
      });
    }

    function displayPublication(cri) {
      const publicationsGrid = document.getElementById('publications-grid');
      const criDate = new Date(cri.timestamp || Date.now());
      const timeString = criDate.toLocaleDateString('fr-FR') + ' √† ' + criDate.toLocaleTimeString('fr-FR', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      const publicationCard = document.createElement('div');
      publicationCard.className = 'cris-card';
      publicationCard.dataset.key = cri.key;
      
      publicationCard.innerHTML = `
        <div class="cris-meta">
          <strong>${cri.pseudo}</strong>
          <span class="text-muted">${timeString}</span>
        </div>
        <div class="cris-content">${cri.text}</div>
        <div class="support-section">
          <span class="support-count"><i class="fas fa-heart"></i> ${cri.supportCount || 0} soutiens</span>
        </div>
        <div class="cris-actions">
          <button class="action-btn delete" onclick="deleteCri('${cri.key}')">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `;
      
      publicationsGrid.appendChild(publicationCard);
    }

    // === FORMULAIRE DE PARTAGE PERSONNEL ===
    document.getElementById('personal-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const text = document.getElementById('personal-message').value.trim();
      const privacy = document.querySelector('input[name="privacy"]:checked').value;
      
      if (!text || !currentUser) return;
      
      if (privacy === 'private') {
        // Message priv√© - envoi √† l'admin
        const newPrivateMessage = {
          from: currentUser.pseudo,
          text: text,
          timestamp: Date.now(),
          read: false
        };
        
        privateMessagesRef.push(newPrivateMessage).then(() => {
          document.getElementById('personal-message').value = '';
          alert('Votre message priv√© a √©t√© envoy√© √† notre √©quipe. Vous recevrez une r√©ponse dans vos notifications.');
          
          // Envoi par email (simulation)
          sendEmailNotification(text);
        });
      } else {
        // Cri du c≈ìur public
        const newCri = {
          pseudo: currentUser.pseudo,
          text: text,
          timestamp: Date.now(),
          supportCount: 0
        };
        
        crisRef.push(newCri).then(() => {
          document.getElementById('personal-message').value = '';
          alert('Votre cri du c≈ìur a √©t√© partag√© avec la communaut√© !');
        });
      }
    });

    // === ENVOI DE NOTIFICATION PAR EMAIL (SIMULATION) ===
    function sendEmailNotification(message) {
      // Dans un environnement r√©el, vous utiliseriez un service d'envoi d'emails
      // Ici, nous simulons simplement l'envoi
      console.log(`Email envoy√© √† avegravity@gmail.com: ${message}`);
      
      // Vous pouvez int√©grer un service comme EmailJS ou un backend pour l'envoi r√©el d'emails
      // Exemple avec EmailJS (n√©cessite une configuration):
      /*
      emailjs.send('service_id', 'template_id', {
        to_email: 'avegravity@gmail.com',
        from_user: currentUser.pseudo,
        message: message
      });
      */
    }

    // === ADMINISTRATION ===
    function loadPrivateMessagesForAdmin() {
      const adminMessages = document.getElementById('admin-messages');
      adminMessages.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement des messages‚Ä¶</div>';
      
      privateMessagesRef.orderByChild('timestamp').once('value', (snapshot) => {
        const messages = snapshot.val() || {};
        const messagesArray = Object.entries(messages)
          .map(([key, value]) => ({ key, ...value }))
          .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        adminMessages.innerHTML = '';
        
        if (messagesArray.length === 0) {
          adminMessages.innerHTML = '<div class="text-muted" style="text-align: center; padding: 2rem;">Aucun message priv√© pour le moment.</div>';
          return;
        }
        
        messagesArray.forEach(msg => {
          displayPrivateMessageForAdmin(msg);
        });
        
        // Mettre √† jour le compteur de messages non lus
        updateUnreadPrivateMessagesCount();
      });
    }
    
    function displayPrivateMessageForAdmin(msg) {
      const adminMessages = document.getElementById('admin-messages');
      const messageDate = new Date(msg.timestamp || Date.now());
      const timeString = messageDate.toLocaleDateString('fr-FR') + ' √† ' + messageDate.toLocaleTimeString('fr-FR', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      const messageDiv = document.createElement('div');
      messageDiv.className = 'admin-message';
      messageDiv.dataset.key = msg.key;
      
      messageDiv.innerHTML = `
        <div class="admin-message-header">
          <strong>De: ${msg.from}</strong>
          <span>${timeString}</span>
        </div>
        <div class="admin-message-content">${msg.text}</div>
        <button class="btn-small" onclick="replyToMessage('${msg.key}', '${msg.from}')">
          <i class="fas fa-reply"></i> R√©pondre
        </button>
      `;
      
      adminMessages.appendChild(messageDiv);
    }
    
    window.replyToMessage = function(messageKey, fromUser) {
      currentResponseTo = { messageKey, fromUser };
      document.getElementById('response-to').textContent = fromUser;
      document.getElementById('admin-response-form').classList.remove('hidden');
      document.getElementById('admin-response').focus();
    };
    
    // Annuler la r√©ponse
    document.getElementById('cancel-response').addEventListener('click', () => {
      document.getElementById('admin-response-form').classList.add('hidden');
      document.getElementById('admin-response').value = '';
      currentResponseTo = null;
    });
    
    // Envoyer la r√©ponse
    document.getElementById('send-response').addEventListener('click', () => {
      const responseText = document.getElementById('admin-response').value.trim();
      
      if (!responseText || !currentResponseTo) return;
      
      // Cr√©er une notification pour l'utilisateur
      const newNotification = {
        to: currentResponseTo.fromUser,
        from: 'Administrateur',
        message: responseText,
        timestamp: Date.now(),
        read: false,
        relatedMessage: currentResponseTo.messageKey
      };
      
      notificationsRef.push(newNotification).then(() => {
        // Marquer le message comme lu
        db.ref(`private_messages/${currentResponseTo.messageKey}/read`).set(true);
        
        document.getElementById('admin-response').value = '';
        document.getElementById('admin-response-form').classList.add('hidden');
        currentResponseTo = null;
        
        alert('R√©ponse envoy√©e avec succ√®s !');
        
        // Recharger les messages pour mettre √† jour l'affichage
        loadPrivateMessagesForAdmin();
      });
    });

    // === NOTIFICATIONS UTILISATEUR ===
    function loadNotifications() {
      const notificationsContainer = document.getElementById('notifications-container');
      notificationsContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement de vos notifications‚Ä¶</div>';
      
      if (!currentUser) return;
      
      notificationsRef.orderByChild('to').equalTo(currentUser.pseudo).once('value', (snapshot) => {
        const notifications = snapshot.val() || {};
        const notificationsArray = Object.entries(notifications)
          .map(([key, value]) => ({ key, ...value }))
          .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        notificationsContainer.innerHTML = '';
        
        if (notificationsArray.length === 0) {
          notificationsContainer.innerHTML = '<div class="text-muted" style="text-align: center; padding: 2rem;">Aucune notification pour le moment.</div>';
          return;
        }
        
        notificationsArray.forEach(notification => {
          displayNotification(notification);
        });
      });
    }
    
    function displayNotification(notification) {
      const notificationsContainer = document.getElementById('notifications-container');
      const notificationDate = new Date(notification.timestamp || Date.now());
      const timeString = notificationDate.toLocaleDateString('fr-FR') + ' √† ' + notificationDate.toLocaleTimeString('fr-FR', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      const notificationDiv = document.createElement('div');
      notificationDiv.className = `notification ${notification.read ? '' : 'unread'}`;
      notificationDiv.dataset.key = notification.key;
      
      notificationDiv.innerHTML = `
        <div class="notification-header">
          <strong>De: ${notification.from}</strong>
          <span>${timeString}</span>
        </div>
        <div class="notification-content">${notification.message}</div>
      `;
      
      notificationsContainer.appendChild(notificationDiv);
    }
    
    function markNotificationsAsRead() {
      if (!currentUser) return;
      
      notificationsRef.orderByChild('to').equalTo(currentUser.pseudo).once('value', (snapshot) => {
        const notifications = snapshot.val() || {};
        const updates = {};
        
        Object.keys(notifications).forEach(key => {
          if (!notifications[key].read) {
            updates[`notifications/${key}/read`] = true;
          }
        });
        
        if (Object.keys(updates).length > 0) {
          db.ref().update(updates).then(() => {
            updateUnreadNotificationsCount();
            loadNotifications();
          });
        }
      });
    }

    // √âcouter les changements de supports pour mettre √† jour en temps r√©el
    supportsRef.on('child_added', (snapshot) => {
      updateSupportCount(snapshot.key);
      checkUserSupport(snapshot.key);
    });

    supportsRef.on('child_removed', (snapshot) => {
      updateSupportCount(snapshot.key);
      checkUserSupport(snapshot.key);
    });

    // Mettre √† jour les compteurs de notifications p√©riodiquement
    setInterval(() => {
      if (currentUser) {
        updateUnreadCount();
        updateUnreadCrisCount();
        updateUnreadNotificationsCount();
        if (currentUser.pseudo === "IamTheAdmin") {
          updateUnreadPrivateMessagesCount();
        }
      }
    }, 30000);
  </script>
</body>
</html>